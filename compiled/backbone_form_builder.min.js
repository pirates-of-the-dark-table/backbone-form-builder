(function(){var d,e,a={}.hasOwnProperty,c=function(i,g){for(var f in g){if(a.call(g,f)){i[f]=g[f]}}function h(){this.constructor=i}h.prototype=g.prototype;i.prototype=new h();i.__super__=g.prototype;return i},b=[].indexOf||function(h){for(var g=0,f=this.length;g<f;g++){if(g in this&&this[g]===h){return g}}return -1};Backbone.FormBuilder={labelMethod:function(f,g){return Backbone.FormBuilder.camelize(""+g)},parseErrors:function(f){return JSON.parse(f).errors},camelize:function(f){return f.replace(/(?:^|[-_])(\w)/g,function(g,h){if(h){return h.toUpperCase()}})},underscore:function(f){return f.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").toLowerCase()}};Backbone.FormBuilder.Form=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.tagName="form";f.prototype.initialize=function(h){var i,j=this;this.fields||(this.fields=[]);this.buttons||(this.buttons=[]);i={success:h.success,error:h.error};return $(this.el).submit(function(){j.save(i);return false})};f.prototype.formData=function(){var m,i,h,l,k,j;i=$(this.el).serializeArray();h={};for(k=0,j=i.length;k<j;k++){m=i[k];l=m.value||"";h[m.name]=l}return h};f.prototype.save=function(h){var k,j,i;if(h==null){h={}}j=this;i=this.modelKey();k={};k[i]=this.formData();return this.model.save(k,{success:h.success,error:function(m,l){var n;if(h.error){h.error(this.model)}n=j.parseErrors(l.responseText);return j.renderErrors(n)}})};f.prototype.modelKey=function(){return Backbone.FormBuilder.underscore(this.model.constructor.name)};f.prototype.render=function(){var k,o,n,l,j,i,m,h;$(this.el).html("");m=this.fields;for(n=0,j=m.length;n<j;n++){o=m[n];o.render();$(this.el).append(o.el)}h=this.buttons;for(l=0,i=h.length;l<i;l++){k=h[l];k.render();$(this.el).append(k.el)}return this};f.prototype.renderErrors=function(m){var l,k,i,j,h;j=this.fields;h=[];for(k=0,i=j.length;k<i;k++){l=j[k];h.push(l.renderErrors(m[l.name]))}return h};f.prototype.addField=function(i,j,h){var k;if(h==null){h={}}k=new Backbone.FormBuilder.Fields[Backbone.FormBuilder.camelize(j)](h);k.model=this.model;k.name=i;this.fields.push(k);return k};f.prototype.addButton=function(k,i,l,h){var j;j=new Backbone.FormBuilder.Buttons[Backbone.FormBuilder.camelize(k)](h);j.callback=l;j.label=i;this.buttons.push(j);return j};f.prototype.parseErrors=Backbone.FormBuilder.parseErrors;return f})(Backbone.View);(d=Backbone.FormBuilder).Fields||(d.Fields={});Backbone.FormBuilder.Fields.Base=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.initialize=function(h){if(h==null){h={}}return this.options=h};f.prototype.className="field";f.prototype.render=function(){var h;$(this.el).html("");h=this.input(this.name,this.value(),this.options);h.attr("id",this.inputId());if(this.options.label!==false){$(this.el).append(this.label())}return $(this.el).append(h)};f.prototype.value=function(){return this.model.get(this.name)};f.prototype.input=function(i,j){var h;h=$("<input />");h.attr("name",i);h.attr("type","text");h.attr("value",j);return h};f.prototype.label=function(){var h;h=$("<label/>");h.attr("for",this.inputId());if(this.options.label){h.html(this.options.label)}else{h.html(Backbone.FormBuilder.labelMethod(this.modelName(),this.name))}return h};f.prototype.inputId=function(){return""+(this.modelName())+"_"+this.name};f.prototype.modelName=function(){return Backbone.FormBuilder.underscore(this.model.constructor.name)};f.prototype.renderErrors=function(h){if(h==null){h=[]}if(!this.error_container){this.error_container=$("<div class='errors'/>");$(this.el).append(this.error_container)}if(h.length>0){return this.error_container.html(h.join(", "))}else{this.error_container.remove();return this.error_container=void 0}};return f})(Backbone.View);Backbone.FormBuilder.Fields.Select=(function(f){c(g,f);function g(){return g.__super__.constructor.apply(this,arguments)}g.prototype.input=function(k,l,j){var i,h;if(j.multiple){h=true}i=$("<select />");if(h){i.attr("multiple","multiple")}i.attr("name",k);this.renderOptions(i,l,j.collection,h);return i};g.prototype.renderOptions=function(o,j,m,r){var k,l,q,p,i,n,h;if(r==null){r=false}if(r!==true){j=[j]}h=[];for(i=0,n=m.length;i<n;i++){k=m[i];if(k.value){p=k.value;q=k.text}else{p=q=k}l=$("<option />");l.attr("value",p);if(b.call(j,p)>=0){l.attr("selected","selected")}l.html(q);h.push(o.append(l))}return h};return g})(Backbone.FormBuilder.Fields.Base);Backbone.FormBuilder.Fields.Password=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.input=function(i,j){var h;h=$("<input />");h.attr("name",i);h.attr("type","password");h.attr("value",j);return h};return f})(Backbone.FormBuilder.Fields.Base);Backbone.FormBuilder.Fields.TextArea=(function(f){c(g,f);function g(){return g.__super__.constructor.apply(this,arguments)}g.prototype.input=function(i,j){var h;h=$("<textarea />");h.attr("name",i);h.attr("type","text");h.html(j);return h};return g})(Backbone.FormBuilder.Fields.Base);Backbone.FormBuilder.Fields.Text=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.input=function(i,j){var h;h=$("<input />");h.attr("name",i);h.attr("type","text");h.attr("value",j);return h};return f})(Backbone.FormBuilder.Fields.Base);(e=Backbone.FormBuilder).Buttons||(e.Buttons={});Backbone.FormBuilder.Buttons.Base=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.initialize=function(h){if(h==null){h={}}return this.options=h};f.prototype.className="button";f.prototype.render=function(){return this.$el.html(this.button(this.label,this.callback,this.options))};f.prototype.button=function(i,k,h){var j;j=$("<button>");j.click(k);j.text(i);return j};return f})(Backbone.View);Backbone.FormBuilder.Buttons.Submit=(function(g){c(f,g);function f(){return f.__super__.constructor.apply(this,arguments)}f.prototype.button=function(i,k,h){var j;j=$('<input type="submit">');j.val(i);if(k){j.submit(k)}return j};return f})(Backbone.FormBuilder.Buttons.Base)}).call(this);